import{j as e}from"./vendor-ui-T5L2aXSd.js";import{r as q,e as Y,f as ee,N as se}from"./vendor-react-Dh4HNKln.js";import{I as ae}from"./image-DxiK4jXT.js";import{o as re,s as te,a as ie,u as oe,b as r,i as ne,c as A,d as z,e as ce,f as le,C as b}from"./vendor-forms-s6dZ1fHX.js";import{c as de,I as N,l as me,u as ue,i as J,m as B,n as pe,o as xe,p as he,q as _,j as F,L as v,X as $,B as ge,s as fe}from"./App-BJlSktNm.js";import{T as ve}from"./textarea-Co5cCeDZ.js";import{S as L,a as k,b as V,c as R,d as m}from"./select-CSJDGITD.js";import{r as je,o as be,q as ye}from"./vendor-firebase-D4lSkuMt.js";import"./index-Cd1_NYyQ.js";import"./vendor-charts-Czn4h1RS.js";import"./chevron-down-BQ1DtuyQ.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],we=de("cloud-upload",Ne);function Ee(o,n){for(var a={};o.length;){var l=o[0],x=l.code,u=l.message,c=l.path.join(".");if(!a[c])if("unionErrors"in l){var i=l.unionErrors[0].errors[0];a[c]={message:i.message,type:i.code}}else a[c]={message:u,type:x};if("unionErrors"in l&&l.unionErrors.forEach(function(d){return d.errors.forEach(function(t){return o.push(t)})}),n){var h=a[c].types,g=h&&h[l.code];a[c]=ie(c,n,a,x,g?[].concat(g,l.message):l.message)}o.shift()}return a}function Ae(o,n,a){return a===void 0&&(a={}),function(l,x,u){try{return Promise.resolve(function(c,i){try{var h=Promise.resolve(o[a.mode==="sync"?"parse":"parseAsync"](l,n)).then(function(g){return u.shouldUseNativeValidation&&re({},u),{errors:{},values:a.raw?Object.assign({},l):g}})}catch(g){return i(g)}return h&&h.then?h.then(void 0,i):h}(0,function(c){if(function(i){return Array.isArray(i==null?void 0:i.errors)}(c))return{values:{},errors:te(Ee(c.errors,!u.shouldUseNativeValidation&&u.criteriaMode==="all"),u)};throw c}))}catch(c){return Promise.reject(c)}}}const Se=oe([r(),ne(File)]),Pe=A({title:r().min(5,"O título deve ter pelo menos 5 caracteres."),description:r().min(10,"A descrição deve ter pelo menos 10 caracteres."),price:z.number({invalid_type_error:"O preço é obrigatório."}).min(.01,"O preço deve ser positivo."),category:r().min(1,"Por favor, selecione uma categoria."),condition:r().min(1,"Por favor, selecione a condição do artigo."),images:ce(Se).min(1,"Pelo menos uma imagem é obrigatória."),quantity:z.number().min(1,"A quantidade deve ser pelo menos 1."),brand:r().optional().default(""),material:r().optional().default(""),sizes:r().optional().default("")});A({email:r().email("Por favor, introduza um email válido."),password:r().min(1,"A palavra-passe é obrigatória.")});A({username:r().min(3,"O nome de utilizador deve ter pelo menos 3 caracteres."),email:r().email("Por favor, introduza um email válido."),password:r().min(8,"A palavra-passe deve ter pelo menos 8 caracteres."),confirmPassword:r()}).refine(o=>o.password===o.confirmPassword,{message:"As palavras-passe não correspondem.",path:["confirmPassword"]});A({email:r().email("Email inválido."),firstName:r().min(1,"O nome é obrigatório."),lastName:r().min(1,"O apelido é obrigatório."),phone:r().optional(),country:r().min(1,"O país é obrigatório."),address:r().min(1,"A morada é obrigatória."),city:r().min(1,"A cidade é obrigatória."),region:r().min(1,"A região é obrigatória."),postalCode:r().min(1,"O código postal é obrigatório.")});A({rating:z.number().min(1,"É obrigatório dar uma classificação.").max(5),comment:r().min(10,"O comentário deve ter pelo menos 10 caracteres.").max(500,"O comentário não pode exceder os 500 caracteres.")});const E="---outro---";function H({options:o,value:n,onChange:a,placeholder:l,id:x}){const u=n&&!o.includes(n),[c,i]=q.useState(u?E:n);q.useEffect(()=>{const d=n&&o.includes(n);i(d?n:n?E:"")},[n,o]);const h=d=>{i(d),a(d!==E?d:"")},g=d=>{a(d.target.value)};return e.jsxs("div",{className:"space-y-2 bg-accent/20 rounded-md p-2",children:[e.jsxs(L,{onValueChange:h,value:c,children:[e.jsx(k,{id:x,children:e.jsx(V,{placeholder:l})}),e.jsxs(R,{children:[o.map(d=>e.jsx(m,{value:d,children:d},d)),e.jsx(m,{value:E,children:"Outro..."})]})]}),c===E&&e.jsx(N,{placeholder:"Escreva a sua opção aqui...",value:n,onChange:g,className:"mt-2"})]})}const Ce=["Nike","Adidas","Zara","H&M","Apple","Samsung","Fnac"],Oe=["Algodão","Poliéster","Lã","Seda","Plástico","Metal"];function Ie(){var U;const[o,n]=q.useState(!1),{toast:a}=me(),{addProduct:l}=ue(),{user:x,loading:u}=J(),c=Y(),{control:i,handleSubmit:h,setValue:g,watch:d,formState:{errors:t},reset:X}=le({resolver:Ae(Pe),defaultValues:{title:"",description:"",price:void 0,quantity:1,category:"",condition:"",brand:"",material:"",sizes:"",images:[]}}),T=d("images"),Z=async s=>{const f=s.target.files;if(f){const w=Array.from(f);g("images",[...d("images")||[],...w],{shouldValidate:!0})}},G=s=>{const w=d("images").filter((D,P)=>P!==s);g("images",w,{shouldValidate:!0})},Q=async s=>{if(u||!x){a({variant:"destructive",title:"Erro de Autenticação",description:"Por favor, aguarde ou faça login novamente."});return}n(!0);try{const f=(s.images||[]).filter(p=>typeof p!="string");for(const p of f){if(!p.type.startsWith("image/")){a({variant:"destructive",title:"Ficheiro inválido",description:`Apenas imagens são permitidas. (${p.name})`});return}if(p.size>5*1024*1024){a({variant:"destructive",title:"Imagem muito grande",description:`${p.name} excede 5MB.`});return}}async function w(p){const j=document.createElement("img"),S=URL.createObjectURL(p);await new Promise(M=>{j.onload=()=>M(),j.src=S});const y=document.createElement("canvas"),O=Math.min(1,1200/Math.max(j.width,j.height));y.width=Math.round(j.width*O),y.height=Math.round(j.height*O);const I=y.getContext("2d");return I==null||I.drawImage(j,0,0,y.width,y.height),URL.revokeObjectURL(S),await new Promise(M=>y.toBlob(K=>M(K),"image/jpeg",.8))}const D=(s.images||[]).map(async(p,j)=>{if(typeof p=="string")return p;const S=await w(p),y=`products/${x.uid}/${Date.now()}-${j}.jpg`,C=je(fe,y);return await be(C,S,{contentType:"image/jpeg"}),await ye(C)}),P=await Promise.all(D),W=s.sizes?s.sizes.split(",").map(p=>p.trim().toUpperCase()):[];await l({name:s.title,description:s.description,price:s.price,quantity:s.quantity,category:s.category,condition:s.condition,brand:s.brand,material:s.material,sizes:W,imageUrls:P,imageHint:s.title.split(" ").slice(0,2).join(" "),userEmail:x.email,userName:x.name,userId:x.uid}),a({title:"Anúncio Publicado!",description:"O seu produto foi listado com sucesso!"}),X(),c("/")}catch{a({variant:"destructive",title:"Erro ao Publicar",description:"Ocorreu um erro. Verifique as permissões da base de dados e tente novamente."})}finally{n(!1)}};return u?e.jsxs(B,{children:[e.jsxs(pe,{children:[e.jsx(xe,{children:"Venda o seu artigo"}),e.jsx(he,{children:"A verificar a sua sessão..."})]}),e.jsx(_,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(F,{className:"h-8 w-8 animate-spin text-muted-foreground"})})})]}):e.jsxs("div",{className:"max-w-3xl mx-auto px-6 pt-32 pb-24",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h1",{className:"font-serif text-5xl mb-4 text-primary",children:"Novo Anúncio"}),e.jsx("p",{className:"text-lg text-muted-foreground max-w-xl mx-auto",children:"Dê uma nova vida às suas peças. Preencha os detalhes abaixo para encontrar o próximo dono perfeito."})]}),e.jsx(B,{className:"border-none shadow-xl shadow-black/5 bg-white/50 backdrop-blur-sm",children:e.jsx(_,{className:"p-8 md:p-12",children:e.jsxs("form",{onSubmit:h(Q),className:"space-y-12",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(v,{htmlFor:"image-upload",className:"text-xl font-serif font-medium",children:"Fotografias"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Adicione até 5 fotos"})]}),e.jsxs("div",{className:"relative flex flex-col justify-center items-center w-full h-80 border-2 border-dashed border-muted-foreground/20 rounded-2xl cursor-pointer hover:bg-secondary/30 hover:border-primary/50 transition-all duration-300 group bg-secondary/10",children:[e.jsx(N,{id:"image-upload",type:"file",multiple:!0,className:"absolute w-full h-full opacity-0 cursor-pointer z-10",onChange:Z,accept:"image/*"}),e.jsxs("div",{className:"text-center text-muted-foreground group-hover:text-primary transition-colors p-6",children:[e.jsx("div",{className:"bg-background rounded-full p-4 inline-flex mb-4 shadow-sm group-hover:shadow-md transition-all",children:e.jsx(we,{className:"h-8 w-8"})}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Arraste e solte suas fotos aqui"}),e.jsx("p",{className:"text-sm opacity-70 max-w-xs mx-auto",children:"Formatos suportados: JPG, PNG. Máximo 5MB por foto."})]})]}),T.length>0&&e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-4 animate-in fade-in slide-in-from-bottom-4 duration-500",children:T.map((s,f)=>e.jsxs("div",{className:"relative group aspect-[3/4] rounded-xl overflow-hidden shadow-sm",children:[e.jsx(ae,{src:typeof s=="string"?s:URL.createObjectURL(s),alt:`Pré-visualização ${f+1}`,fill:!0,loading:"lazy",sizes:"(max-width: 640px) 33vw, (max-width: 768px) 25vw, 20vw",className:"object-cover transition-transform duration-500 group-hover:scale-110"}),e.jsx("div",{className:"absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsx("button",{type:"button",onClick:()=>G(f),className:"absolute top-2 right-2 bg-white/90 text-destructive rounded-full p-1.5 opacity-0 group-hover:opacity-100 transition-all hover:bg-white hover:scale-110 shadow-sm",children:e.jsx($,{className:"h-4 w-4"})})]},f))}),t.images&&e.jsxs("p",{className:"text-sm font-medium text-destructive flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"})," ",(U=t.images.message)==null?void 0:U.toString()]})]}),e.jsx("div",{className:"h-px bg-border/50"}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{htmlFor:"title",className:"text-base font-medium text-foreground/80",children:"O que está a vender?"}),e.jsx(b,{name:"title",control:i,render:({field:s})=>e.jsx(N,{id:"title",className:"h-14 px-4 rounded-xl bg-secondary/20 border-transparent focus:bg-background focus:border-primary/20 focus:ring-4 focus:ring-primary/5 transition-all text-lg placeholder:text-muted-foreground/50",placeholder:"Ex: Casaco de Lã Vintage Bege",...s})}),t.title&&e.jsx("p",{className:"text-sm text-destructive",children:t.title.message})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{htmlFor:"description",className:"text-base font-medium text-foreground/80",children:"Descrição detalhada"}),e.jsx(b,{name:"description",control:i,render:({field:s})=>e.jsx(ve,{id:"description",className:"min-h-[160px] p-4 rounded-xl bg-secondary/20 border-transparent focus:bg-background focus:border-primary/20 focus:ring-4 focus:ring-primary/5 transition-all resize-y text-base placeholder:text-muted-foreground/50 leading-relaxed",placeholder:"Conte a história desta peça. Mencione o estado, medidas exatas, material e qualquer defeito visível...",...s})}),t.description&&e.jsx("p",{className:"text-sm text-destructive",children:t.description.message})]})]}),e.jsx("div",{className:"h-px bg-border/50"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12",children:[e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{htmlFor:"brand",className:"text-base font-medium text-foreground/80",children:"Marca"}),e.jsx(b,{name:"brand",control:i,render:({field:s})=>e.jsx(H,{id:"brand",options:Ce,placeholder:"Selecione ou digite",...s})}),t.brand&&e.jsx("p",{className:"text-sm text-destructive",children:t.brand.message})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{htmlFor:"material",className:"text-base font-medium text-foreground/80",children:"Material Principal"}),e.jsx(b,{name:"material",control:i,render:({field:s})=>e.jsx(H,{id:"material",options:Oe,placeholder:"Selecione ou digite",...s})}),t.material&&e.jsx("p",{className:"text-sm text-destructive",children:t.material.message})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{htmlFor:"sizes",className:"text-base font-medium text-foreground/80",children:"Tamanho"}),e.jsx(b,{name:"sizes",control:i,render:({field:s})=>e.jsx(N,{id:"sizes",className:"h-12 rounded-xl bg-secondary/20 border-transparent focus:bg-background focus:border-primary/20 focus:ring-4 focus:ring-primary/5 transition-all",placeholder:"Ex: M, 38, 40",...s,value:s.value??""})}),t.sizes&&e.jsx("p",{className:"text-sm text-destructive",children:t.sizes.message})]})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{className:"text-base font-medium text-foreground/80",children:"Categoria"}),e.jsx(b,{name:"category",control:i,render:({field:s})=>e.jsxs(L,{onValueChange:s.onChange,value:s.value,children:[e.jsx(k,{className:"h-12 rounded-xl bg-secondary/20 border-transparent focus:bg-background focus:border-primary/20 focus:ring-4 focus:ring-primary/5 transition-all",children:e.jsx(V,{placeholder:"Selecione"})}),e.jsxs(R,{children:[e.jsx(m,{value:"Roupa",children:"Roupa"}),e.jsx(m,{value:"Calçado",children:"Calçado"}),e.jsx(m,{value:"Livros",children:"Livros"}),e.jsx(m,{value:"Eletrónica",children:"Eletrónica"}),e.jsx(m,{value:"Móveis",children:"Móveis"}),e.jsx(m,{value:"Decoração",children:"Decoração"}),e.jsx(m,{value:"Esportes",children:"Esportes"}),e.jsx(m,{value:"Jogos",children:"Jogos"}),e.jsx(m,{value:"Arte",children:"Arte"}),e.jsx(m,{value:"Outro",children:"Outro"})]})]})}),t.category&&e.jsx("p",{className:"text-sm text-destructive",children:t.category.message})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{className:"text-base font-medium text-foreground/80",children:"Condição"}),e.jsx(b,{name:"condition",control:i,render:({field:s})=>e.jsxs(L,{onValueChange:s.onChange,value:s.value,children:[e.jsx(k,{className:"h-12 rounded-xl bg-secondary/20 border-transparent focus:bg-background focus:border-primary/20 focus:ring-4 focus:ring-primary/5 transition-all",children:e.jsx(V,{placeholder:"Selecione"})}),e.jsxs(R,{children:[e.jsx(m,{value:"Novo",children:"Novo com etiqueta"}),e.jsx(m,{value:"Muito bom",children:"Excelente estado"}),e.jsx(m,{value:"Bom",children:"Bom estado"})]})]})}),t.condition&&e.jsx("p",{className:"text-sm text-destructive",children:t.condition.message})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{htmlFor:"quantity",className:"text-base font-medium text-foreground/80",children:"Quantidade"}),e.jsx(b,{name:"quantity",control:i,render:({field:s})=>e.jsx(N,{id:"quantity",type:"number",step:"1",className:"h-12 rounded-xl bg-secondary/20 border-transparent focus:bg-background focus:border-primary/20 focus:ring-4 focus:ring-primary/5 transition-all",placeholder:"1",...s,value:s.value??""})}),t.quantity&&e.jsx("p",{className:"text-sm text-destructive",children:t.quantity.message})]})]})]}),e.jsx("div",{className:"h-px bg-border/50"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(v,{htmlFor:"price",className:"text-xl font-serif font-medium",children:"Defina o preço"}),e.jsxs("div",{className:"relative max-w-xs",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-muted-foreground font-medium text-lg",children:"€"}),e.jsx(b,{name:"price",control:i,render:({field:s})=>e.jsx(N,{id:"price",type:"number",step:"0.01",className:"h-16 pl-10 text-2xl font-medium rounded-xl bg-secondary/20 border-transparent focus:bg-background focus:border-primary/20 focus:ring-4 focus:ring-primary/5 transition-all placeholder:text-muted-foreground/30",placeholder:"0.00",...s,value:s.value??""})})]}),t.price&&e.jsx("p",{className:"text-sm text-destructive",children:t.price.message}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"O preço inclui taxas de proteção ao vendedor."})]}),e.jsx("div",{className:"pt-8",children:e.jsxs(ge,{type:"submit",className:"w-full h-14 text-lg font-medium rounded-xl bg-primary hover:bg-primary/90 shadow-lg shadow-primary/20 transition-all hover:scale-[1.01] active:scale-[0.99]",size:"lg",disabled:o||u,children:[(o||u)&&e.jsx(F,{className:"mr-2 h-5 w-5 animate-spin"}),"Publicar Anúncio"]})})]})})})]})}function Be(){const{user:o,loading:n}=J(),a=ee();return n?e.jsx("div",{className:"container flex min-h-[50vh] items-center justify-center",children:e.jsx(F,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):o?e.jsx(e.Fragment,{children:e.jsx(Ie,{})}):e.jsx(se,{to:`/login?redirect=${a.pathname}`,replace:!0})}export{Be as default};
