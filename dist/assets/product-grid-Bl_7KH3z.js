import{j as s}from"./vendor-ui-T5L2aXSd.js";import{u as ee,r as n}from"./vendor-react-Dh4HNKln.js";import{P as V}from"./product-card-Bemfo3rH.js";import{u as te,i as se,j as re,k as W,S as P}from"./App-BJlSktNm.js";const oe=()=>s.jsxs("div",{className:"space-y-2",children:[s.jsx(P,{className:"h-[250px] w-full rounded-lg"}),s.jsx(P,{className:"h-5 w-3/4"}),s.jsx(P,{className:"h-5 w-1/2"})]});function ae({personalized:m=!1}){const[r]=ee(),{products:b,loadMoreProducts:v,hasMoreProducts:a,loading:X}=te(),{user:h}=se(),[f,M]=n.useState(!1),x=n.useRef(),g=n.useRef(),w=n.useCallback(async()=>{f||!a||(g.current&&clearTimeout(g.current),g.current=setTimeout(async()=>{M(!0);try{await v()}finally{M(!1)}},100))},[f,a,v]),Y=n.useCallback(e=>{f||(x.current&&x.current.disconnect(),x.current=new IntersectionObserver(l=>{l[0].isIntersecting&&a&&w()},{rootMargin:"800px",threshold:.05}),e&&x.current.observe(e))},[f,a,w]);n.useEffect(()=>()=>{g.current&&clearTimeout(g.current)},[]);const d=n.useMemo(()=>{var F,U,z,D,G,O,Q,H,J;if(m&&h){const{preferredBrands:t=[],preferredSizes:i=[]}=h;return t.length===0&&i.length===0?[]:b.filter(o=>o.status!=="vendido"&&o.userId!==h.uid).map(o=>{var c;let u=0;return o.brand&&t.includes(o.brand)&&(u+=2),(c=o.sizes)!=null&&c.some(j=>i.includes(j))&&(u+=1),{...o,score:u}}).filter(o=>o.score>0).sort((o,u)=>u.score-o.score)}let e=b;const l=((F=r.get("q"))==null?void 0:F.toLowerCase())||"",S=((U=r.get("conditions"))==null?void 0:U.split(",").filter(Boolean))||[],B=((z=r.get("brands"))==null?void 0:z.split(",").filter(Boolean))||[],L=((D=r.get("sizes"))==null?void 0:D.split(",").filter(Boolean).map(t=>t.trim().toUpperCase()))||[],R=((G=r.get("colors"))==null?void 0:G.split(",").filter(Boolean))||[],k=((O=r.get("locations"))==null?void 0:O.split(",").filter(Boolean))||[],I=((Q=r.get("categories"))==null?void 0:Q.split(",").filter(Boolean))||[],T=((H=r.get("materials"))==null?void 0:H.split(",").filter(Boolean))||[],A=((J=r.get("styles"))==null?void 0:J.split(",").filter(Boolean))||[],q=r.get("minPrice"),y=r.get("maxPrice"),E=q?Number(q):void 0,_=y?y==="Infinity"?1/0:Number(y):void 0,p=r.get("sort")||"";return l&&(e=e.filter(t=>t.name.toLowerCase().includes(l)||t.description.toLowerCase().includes(l))),S.length>0&&(e=e.filter(t=>S.includes(t.condition))),B.length>0&&(e=e.filter(t=>t.brand&&B.includes(t.brand))),L.length>0&&(e=e.filter(t=>{var i;return(i=t.sizes)==null?void 0:i.some(o=>L.includes(o.toUpperCase()))})),I.length>0&&(e=e.filter(t=>I.includes(t.category))),T.length>0&&(e=e.filter(t=>t.material&&T.includes(t.material))),A.length>0&&(e=e.filter(t=>t.style&&A.includes(t.style))),R.length>0&&(e=e.filter(t=>t.color&&R.includes(t.color))),k.length>0&&(e=e.filter(t=>t.location&&k.includes(t.location))),typeof E=="number"&&(e=e.filter(t=>t.price>=E)),typeof _=="number"&&(e=e.filter(t=>t.price<=_)),p&&(p==="price_asc"?e=[...e].sort((t,i)=>t.price-i.price):p==="price_desc"?e=[...e].sort((t,i)=>i.price-t.price):p==="newest"&&(e=[...e].sort((t,i)=>{var c,j,N,K;const o=((j=(c=t.createdAt)==null?void 0:c.toMillis)==null?void 0:j.call(c))??0;return(((K=(N=i.createdAt)==null?void 0:N.toMillis)==null?void 0:K.call(N))??0)-o}))),e},[r,b,m,h]),C=n.useMemo(()=>r.toString().length>0,[r]),Z=n.useMemo(()=>!m&&a,[m,a]),$=n.useMemo(()=>d.length,[d.length]);return s.jsxs("section",{id:"products",children:[s.jsxs("div",{className:"mb-8",children:[s.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:m?"Recomendado para Si":C?"Resultados da Pesquisa":"Descubra os Nossos Produtos"}),s.jsxs("p",{className:"text-muted-foreground mt-2",children:[$," resultado(s) encontrado(s)"]})]}),X?s.jsx("div",{className:"grid grid-cols-1 gap-x-8 gap-y-16 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:Array.from({length:8}).map((e,l)=>s.jsx(oe,{},l))}):d.length>0?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"grid grid-cols-1 gap-x-8 gap-y-16 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:d.map((e,l)=>d.length===l+1&&Z?s.jsx("div",{ref:Y,children:s.jsx(V,{product:e})},e.id):s.jsx(V,{product:e},e.id))}),f&&s.jsx("div",{className:"text-center py-8",children:s.jsx(re,{className:"h-8 w-8 animate-spin mx-auto text-primary"})}),d.length===0&&C&&s.jsxs("div",{className:"text-center py-16",children:[s.jsx(W,{className:"mx-auto h-12 w-12 text-muted-foreground"}),s.jsx("h3",{className:"mt-4 text-xl font-semibold",children:"Nenhum produto encontrado"}),s.jsx("p",{className:"mt-2 text-muted-foreground",children:"Tente ajustar os filtros ou pesquisar por outro termo."})]})]}):s.jsxs("div",{className:"text-center py-16",children:[s.jsx(W,{className:"mx-auto h-12 w-12 text-muted-foreground"}),s.jsx("h3",{className:"mt-4 text-xl font-semibold",children:"Nenhum produto encontrado"}),s.jsx("p",{className:"mt-2 text-muted-foreground",children:"Tente ajustar os filtros ou pesquisar por outro termo."})]})]})}export{ae as P};
