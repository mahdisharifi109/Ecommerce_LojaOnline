import{j as e}from"./vendor-ui-T5L2aXSd.js";import{r as n,u as G}from"./vendor-react-Dh4HNKln.js";import{c as v,i as V,r as P,V as R,a as h,b as J,I as A,F as I,G as E,J as S,w as C,B as j,x as z}from"./App-BJlSktNm.js";import{S as _}from"./scroll-area-DsyxpSpR.js";import{w as q,x as F,z as D,y as T,G as $,A as W}from"./vendor-firebase-D4lSkuMt.js";import{A as H}from"./arrow-left-BLP-Hjny.js";import"./index-Cd1_NYyQ.js";import"./vendor-charts-Czn4h1RS.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],Q=v("check-check",K);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],Y=v("ellipsis-vertical",X);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],ee=v("paperclip",Z);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],ae=v("phone",se);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],L=v("send",te);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],ne=v("video",re);function ie(){const{user:s}=V(),[c,i]=n.useState([]),[g,t]=n.useState(!0);return n.useEffect(()=>{if(!(s!=null&&s.uid)){i([]),t(!1);return}const l=q(P,"conversations"),m=F(l,T("participantIds","array-contains",s.uid),D("updatedAt","desc")),f=$(m,o=>{const x=o.docs.map(u=>({id:u.id,...u.data()}));i(x),t(!1)},o=>{console.error("Error listening to conversations:",o),t(!1)});return()=>f()},[s==null?void 0:s.uid]),{conversations:c,loading:g}}function oe(s){const[c,i]=n.useState([]),[g,t]=n.useState(!1);return n.useEffect(()=>{if(!s){i([]);return}t(!0);const m=q(P,"conversations",s,"messages"),f=F(m,D("createdAt","asc"),W(100)),o=$(f,x=>{const u=x.docs.map(b=>({id:b.id,...b.data()}));i(u),t(!1)},x=>{console.error("Error listening to messages:",x),t(!1)});return()=>o()},[s]),{messages:c,loading:g,sendMessage:async(m,f)=>{s&&await R.sendMessage(s,{conversationId:s,senderId:f,text:m})}}}function pe(){const{user:s}=V(),[c]=G(),{conversations:i,loading:g}=ie(),[t,l]=n.useState(null),{messages:m,sendMessage:f}=oe(t),[o,x]=n.useState(""),u=n.useRef(null),[b,B]=n.useState(!1);n.useEffect(()=>{(async()=>{const r=c.get("seller"),N=c.get("product");if(!s||!r||r===s.uid||g)return;const y=i.find(d=>d.participantIds.includes(r)&&d.participantIds.includes(s.uid));if(y)l(y.id);else try{const d=await R.createConversation({participantIds:[s.uid,r],participants:{[s.uid]:{name:s.name||"Eu",avatar:s.photoURL||""},[r]:{name:"Vendedor",avatar:""}},lastMessage:{text:N?"Olá! Estou interessado neste artigo.":"Olá!",senderId:s.uid,createdAt:new Date,read:!1},unreadCount:{[r]:1,[s.uid]:0}});l(d)}catch(d){console.error("Error creating conversation:",d)}})()},[c,s,i,g]),n.useEffect(()=>{!t&&i.length>0&&!c.get("seller")&&l(i[0].id)},[i,t,c]),n.useEffect(()=>{u.current&&u.current.scrollIntoView({behavior:"smooth"})},[m]),n.useEffect(()=>{const a=()=>B(window.innerWidth<768);return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]);const O=async a=>{a.preventDefault(),!(!o.trim()||!(s!=null&&s.uid))&&(await f(o,s.uid),x(""))},p=i.find(a=>a.id===t),k=p==null?void 0:p.participantIds.find(a=>a!==(s==null?void 0:s.uid)),w=k?p==null?void 0:p.participants[k]:null;return e.jsxs("div",{className:"flex h-[calc(100vh-12rem)] min-h-[500px] bg-background overflow-hidden border rounded-2xl shadow-sm",children:[e.jsxs("div",{className:h("w-full md:w-80 lg:w-96 border-r border-border/40 flex flex-col bg-background transition-all duration-300",p&&b?"hidden":"flex"),children:[e.jsxs("div",{className:"p-4 border-b border-border/40",children:[e.jsx("h1",{className:"font-serif text-2xl mb-4",children:"Mensagens"}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(A,{placeholder:"Pesquisar conversas...",className:"pl-9 bg-secondary/20 border-transparent focus:bg-background transition-all rounded-xl"})]})]}),e.jsx(_,{className:"flex-1",children:e.jsx("div",{className:"flex flex-col p-2 gap-1",children:i.map(a=>{var d,M;const r=a.participantIds.find(U=>U!==(s==null?void 0:s.uid)),N=r?a.participants[r]:{name:"Unknown",avatar:""},y=t===a.id;return e.jsxs("button",{onClick:()=>l(a.id),className:h("flex items-center gap-3 p-3 rounded-xl transition-all text-left group",y?"bg-secondary/40":"hover:bg-secondary/20"),children:[e.jsx("div",{className:"relative",children:e.jsxs(I,{className:"h-12 w-12 border border-border/50",children:[e.jsx(E,{src:N.avatar}),e.jsx(S,{children:N.name[0]})]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-baseline mb-1",children:[e.jsx("span",{className:"font-medium truncate",children:N.name}),e.jsx("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:(d=a.lastMessage)!=null&&d.createdAt?C(a.lastMessage.createdAt.toDate(),{locale:z}):""})]}),e.jsx("p",{className:h("text-sm truncate text-muted-foreground"),children:((M=a.lastMessage)==null?void 0:M.text)||"Inicie a conversa"})]})]},a.id)})})})]}),e.jsx("div",{className:h("flex-1 flex flex-col bg-[#F9F8F4]/50 transition-all duration-300",!t&&b?"hidden":"flex"),children:t&&w?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"h-16 border-b border-border/40 bg-background/80 backdrop-blur-md flex items-center justify-between px-4 sticky top-0 z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[b&&e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>l(null),className:"-ml-2",children:e.jsx(H,{className:"h-5 w-5"})}),e.jsxs(I,{className:"h-10 w-10 border border-border/50",children:[e.jsx(E,{src:w.avatar}),e.jsx(S,{children:w.name[0]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-medium leading-none",children:w.name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Online agora"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-foreground",children:e.jsx(ae,{className:"h-5 w-5"})}),e.jsx(j,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-foreground",children:e.jsx(ne,{className:"h-5 w-5"})}),e.jsx(j,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-foreground",children:e.jsx(Y,{className:"h-5 w-5"})})]})]}),e.jsx(_,{className:"flex-1 p-4",children:e.jsxs("div",{className:"space-y-4 max-w-3xl mx-auto",children:[m.map(a=>{const r=a.senderId===(s==null?void 0:s.uid);return e.jsx("div",{className:h("flex w-full",r?"justify-end":"justify-start"),children:e.jsxs("div",{className:h("max-w-[75%] md:max-w-[60%] px-4 py-2.5 shadow-sm relative group",r?"bg-emerald-100/80 text-emerald-900 rounded-2xl rounded-tr-sm":"bg-white text-foreground rounded-2xl rounded-tl-sm border border-border/20"),children:[e.jsx("p",{className:"text-sm leading-relaxed",children:a.text}),e.jsxs("div",{className:h("flex items-center justify-end gap-1 mt-1",r?"text-emerald-700/70":"text-muted-foreground/70"),children:[e.jsx("span",{className:"text-[10px]",children:a.createdAt?C(a.createdAt.toDate(),{locale:z}):"Enviando..."}),r&&e.jsx(Q,{className:"h-3 w-3"})]})]})},a.id)}),e.jsx("div",{ref:u})]})}),e.jsx("div",{className:"p-4 bg-background border-t border-border/40",children:e.jsxs("form",{onSubmit:O,className:"max-w-3xl mx-auto flex items-end gap-2",children:[e.jsx(j,{type:"button",variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-foreground mb-0.5",children:e.jsx(ee,{className:"h-5 w-5"})}),e.jsx("div",{className:"flex-1 relative",children:e.jsx(A,{value:o,onChange:a=>x(a.target.value),placeholder:"Escreva uma mensagem...",className:"min-h-[44px] py-3 bg-secondary/20 border-transparent focus:bg-background rounded-xl pr-10 resize-none"})}),e.jsx(j,{type:"submit",size:"icon",className:h("h-11 w-11 rounded-xl transition-all duration-300 shadow-md",o.trim()?"bg-primary hover:bg-primary/90":"bg-secondary text-muted-foreground hover:bg-secondary/80"),disabled:!o.trim(),children:e.jsx(L,{className:"h-5 w-5"})})]})})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-center p-8 text-muted-foreground",children:[e.jsx("div",{className:"h-20 w-20 bg-secondary/30 rounded-full flex items-center justify-center mb-4",children:e.jsx(L,{className:"h-8 w-8 opacity-50"})}),e.jsx("h3",{className:"font-serif text-2xl text-foreground mb-2",children:"Suas Mensagens"}),e.jsx("p",{className:"max-w-xs",children:"Selecione uma conversa para começar a negociar ou tirar dúvidas."})]})})]})}export{pe as default};
