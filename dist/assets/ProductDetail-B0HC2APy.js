import{j as e}from"./vendor-ui-T5L2aXSd.js";import{k as ie,e as oe,r as d,L as h}from"./vendor-react-Dh4HNKln.js";import{c as D,r as f,u as ne,t as de,i as ce,l as le,S as N,B as m,d as y,v as M,U as _,M as O,H as me,w as xe,x as ue}from"./App-BJlSktNm.js";import{I as V}from"./image-DxiK4jXT.js";import{R as he,S as I}from"./star-rating-BRvWqeeD.js";import{x as B,w as z,y as ge,A as H,B as J,z as pe,j as G,I as je,T as ve}from"./vendor-firebase-D4lSkuMt.js";import{T as fe}from"./textarea-Co5cCeDZ.js";import{L as Q}from"./lock-DF-DvFPS.js";import"./index-Cd1_NYyQ.js";import"./vendor-charts-Czn4h1RS.js";import"./star-BcHBrKpp.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],be=D("chevron-left",Ne);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],ye=D("share-2",we);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]],Se=D("shopping-cart",Re);function W(i,o){if(!i)return"";if(i.includes("firebasestorage.googleapis.com")){const n=new URL(i);return o&&n.searchParams.set("w",o.toString()),n.toString()}return i}const R={async addReview(i,o){const n=G(f,"products",i),c=G(z(f,"reviews",i,"user_reviews"));try{return await je(f,async u=>{const r=await u.get(n);if(!r.exists())throw new Error("Produto n√£o encontrado");const b=r.data(),l=b.rating||0,j=b.reviewCount||0,w=j+1,S=(l*j+o.rating)/w;u.set(c,{...o,createdAt:ve.now()}),u.update(n,{rating:S,reviewCount:w})}),!0}catch(u){throw console.error("Erro ao adicionar avalia√ß√£o:",u),u}},async getReviews(i){try{const o=B(z(f,"reviews",i,"user_reviews"),pe("createdAt","desc"),H(50));return(await J(o)).docs.map(c=>({id:c.id,...c.data()}))}catch(o){return console.error("Erro ao buscar avalia√ß√µes:",o),[]}},async getUserReview(i,o){try{const n=B(z(f,"reviews",i,"user_reviews"),ge("userId","==",o),H(1)),c=await J(n);return c.empty?null:{id:c.docs[0].id,...c.docs[0].data()}}catch(n){return console.error("Erro ao verificar avalia√ß√£o do usu√°rio:",n),null}}};function $e(){var $,L;const{id:i}=ie(),o=oe(),{products:n,loading:c}=ne(),{addToCart:u}=de(),{user:r,toggleFavorite:b}=ce(),{toast:l}=le(),[j,w]=d.useState(0),[S,E]=d.useState(!1),[x,U]=d.useState([]),[g,F]=d.useState(null),[p,K]=d.useState(0),[C,X]=d.useState(""),[P,T]=d.useState(!1),s=d.useMemo(()=>n.find(a=>a.id===i),[n,i]);d.useEffect(()=>{s!=null&&s.id&&(R.getReviews(s.id).then(U),r&&R.getUserReview(s.id,r.uid).then(F))},[s==null?void 0:s.id,r]);const Y=d.useMemo(()=>x.length===0?0:x.reduce((a,t)=>a+t.rating,0)/x.length,[x]),Z=d.useMemo(()=>{const a={1:0,2:0,3:0,4:0,5:0};return x.forEach(t=>{const q=Math.round(t.rating);a[q]!==void 0&&a[q]++}),a},[x]),ee=async a=>{if(a.preventDefault(),!(!r||!s||p===0)){T(!0);try{await R.addReview(s.id,{userId:r.uid,userName:r.name||"Utilizador",userAvatar:r.photoURL||void 0,rating:p,comment:C,productId:s.id}),l({title:"Avalia√ß√£o enviada!",description:"Obrigado pelo seu feedback."});const t=await R.getReviews(s.id);U(t),F({userId:r.uid,userName:r.name||"Utilizador",rating:p,comment:C,createdAt:{},productId:s.id})}catch(t){console.error("Erro ao enviar avalia√ß√£o:",t),l({title:"Erro",description:`N√£o foi poss√≠vel enviar a avalia√ß√£o: ${t.message||"Erro desconhecido"}`,variant:"destructive"})}finally{T(!1)}}},k=(($=r==null?void 0:r.favorites)==null?void 0:$.includes((s==null?void 0:s.id)||""))||!1,se=async()=>{if(s){if(!r){l({title:"Fa√ßa login",description:"Precisa de estar autenticado para guardar favoritos.",variant:"destructive"});return}E(!0);try{await b(s.id),k||l({title:"Guardado ‚ú®",description:"Adicionado √† sua lista de desejos.",className:"bg-rose-50 border-rose-200 text-rose-800"})}catch{l({title:"Erro",description:"N√£o foi poss√≠vel atualizar os favoritos.",variant:"destructive"})}finally{E(!1)}}},ae=()=>{if(s){if(!r){l({title:"Junte-se a n√≥s! üåø",description:"Para levar essa pe√ßa exclusiva para casa, junte-se √† nossa comunidade sustent√°vel.",className:"bg-primary/10 border-primary/20 text-primary"}),o("/login?redirect=/product/"+i);return}u({product:s,quantity:1}),l({title:"Adicionado ao carrinho",description:`${s.name} foi adicionado.`})}},re=async()=>{if(navigator.share&&s)try{await navigator.share({title:s.name,text:s.description,url:window.location.href})}catch{}else await navigator.clipboard.writeText(window.location.href),l({title:"Link copiado"})},te=a=>{if(!a)return"";const t=a.toDate?a.toDate():new Date(a);return new Intl.DateTimeFormat("pt-PT",{day:"numeric",month:"short",year:"numeric"}).format(t)};if(c)return e.jsx("div",{className:"container px-4 py-8 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"grid gap-8 lg:grid-cols-2",children:[e.jsx(N,{className:"aspect-square w-full rounded-lg"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(N,{className:"h-8 w-3/4"}),e.jsx(N,{className:"h-6 w-1/4"}),e.jsx(N,{className:"h-24 w-full"}),e.jsx(N,{className:"h-12 w-full"})]})]})});if(!s)return e.jsxs("div",{className:"container flex min-h-[50vh] flex-col items-center justify-center px-4 py-16 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Artigo n√£o encontrado"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Este artigo pode ter sido removido ou o link est√° incorreto."}),e.jsx(m,{asChild:!0,className:"mt-6",children:e.jsx(h,{to:"/catalog",children:"Ver cat√°logo"})})]});const v=(r==null?void 0:r.uid)===s.userId,A=s.status==="vendido";return e.jsxs("div",{className:"container px-4 py-6 sm:px-6 sm:py-8 lg:px-8",children:[e.jsxs("nav",{className:"mb-6 flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsxs(m,{variant:"ghost",size:"sm",className:"-ml-2 gap-1",onClick:()=>o(-1),children:[e.jsx(be,{className:"h-4 w-4"}),"Voltar"]}),e.jsx("span",{children:"/"}),e.jsx(h,{to:"/catalog",className:"hover:text-foreground",children:"Cat√°logo"}),e.jsx("span",{children:"/"}),e.jsx(h,{to:`/catalog?category=${s.category}`,className:"hover:text-foreground",children:s.category})]}),e.jsxs("div",{className:"grid gap-8 lg:grid-cols-2 lg:gap-12",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative aspect-square overflow-hidden rounded-lg bg-muted/30",children:[e.jsx(V,{src:W(((L=s.imageUrls)==null?void 0:L[j])||"",800),alt:s.name,fill:!0,priority:!0,sizes:"(max-width: 1024px) 100vw, 50vw",className:"object-cover"}),A&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsx(y,{variant:"destructive",className:"text-lg font-bold",children:"VENDIDO"})})]}),s.imageUrls&&s.imageUrls.length>1&&e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:s.imageUrls.map((a,t)=>e.jsx("button",{onClick:()=>w(t),className:`relative h-20 w-20 shrink-0 overflow-hidden rounded-md border-2 transition-colors ${t===j?"border-primary":"border-transparent hover:border-border"}`,children:e.jsx(V,{src:W(a,100),alt:`${s.name} - imagem ${t+1}`,fill:!0,sizes:"80px",className:"object-cover"})},t))})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.isVerified&&e.jsxs(y,{className:"bg-blue-500 hover:bg-blue-600",children:[e.jsx(M,{className:"mr-1 h-3 w-3"}),"Verificado"]}),e.jsx(y,{variant:"secondary",children:s.category}),e.jsx(y,{variant:"outline",children:s.condition})]}),e.jsx("h1",{className:"mt-3 font-heading text-2xl font-bold sm:text-3xl",children:s.name}),e.jsxs("p",{className:"mt-4 text-3xl font-bold text-primary",children:[s.price.toFixed(2)," ‚Ç¨"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"font-semibold",children:"Descri√ß√£o"}),e.jsx("p",{className:"whitespace-pre-wrap text-muted-foreground",children:s.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 rounded-lg border bg-card/50 p-4",children:[s.brand&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Marca"}),e.jsx("p",{className:"font-medium",children:s.brand})]}),s.material&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Material"}),e.jsx("p",{className:"font-medium",children:s.material})]}),s.sizes&&s.sizes.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Tamanhos"}),e.jsx("p",{className:"font-medium",children:s.sizes.join(", ")})]}),s.createdAt&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Publicado"}),e.jsx("p",{className:"font-medium",children:te(s.createdAt)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 rounded-md border p-3",children:[e.jsx(M,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Prote√ß√£o ao Comprador"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Reembolso total se o artigo n√£o corresponder √† descri√ß√£o."})]})]}),e.jsxs("div",{className:"flex items-center gap-3 rounded-md border p-3",children:[e.jsx(Q,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Pagamento Seguro"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Os seus dados est√£o protegidos com encripta√ß√£o SSL."})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 rounded-lg border bg-card/50 p-4",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-primary/10",children:e.jsx(_,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(h,{to:`/profile/${s.userId}`,className:"hover:underline",children:e.jsx("p",{className:"font-medium",children:s.userName||"Utilizador"})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Vendedor"})]}),!v&&e.jsx(m,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(h,{to:`/messages?seller=${s.userId}&product=${s.id}`,children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),"Mensagem"]})})]}),e.jsx("div",{className:"flex flex-col gap-3 sm:flex-row",children:v?e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"flex-1",asChild:!0,children:e.jsx(h,{to:`/product/${s.id}/edit`,children:"Editar an√∫ncio"})}),e.jsx(m,{variant:"outline",className:"flex-1",asChild:!0,children:e.jsx(h,{to:"/dashboard",children:"Ver dashboard"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"flex-1",onClick:ae,disabled:A,children:r?e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"mr-2 h-4 w-4"}),A?"Indispon√≠vel":"Adicionar √† Sacola"]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"Fa√ßa Login para Comprar"]})}),e.jsx(m,{variant:"outline",size:"icon",onClick:se,disabled:S,"aria-label":k?"Remover dos favoritos":"Adicionar aos favoritos",children:e.jsx(me,{className:`h-4 w-4 transition-all ${k?"fill-rose-500 text-rose-500 scale-110":""}`})}),e.jsx(m,{variant:"outline",size:"icon",onClick:re,"aria-label":"Partilhar",children:e.jsx(ye,{className:"h-4 w-4"})})]})})]})]}),e.jsxs("div",{className:"mt-16 border-t pt-10",children:[e.jsx("h2",{className:"text-2xl font-bold mb-8",children:"Avalia√ß√µes dos Clientes"}),e.jsxs("div",{className:"grid gap-10 md:grid-cols-[300px_1fr]",children:[e.jsxs("div",{children:[e.jsx(he,{average:Y,totalReviews:x.length,distribution:Z}),!g&&r&&!v&&e.jsxs("div",{className:"mt-6 p-4 bg-secondary/30 rounded-lg border border-border/50",children:[e.jsx("h3",{className:"font-medium mb-2",children:"J√° comprou este artigo?"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Partilhe a sua opini√£o com outros compradores."})]})]}),e.jsxs("div",{className:"space-y-8",children:[!g&&r&&!v&&e.jsxs("form",{onSubmit:ee,className:"bg-card border rounded-xl p-6 shadow-sm",children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Escrever uma avalia√ß√£o"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Classifica√ß√£o"}),e.jsx(I,{rating:p,onRatingChange:K,size:"lg"}),p===0&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Selecione uma classifica√ß√£o"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"O seu coment√°rio"}),e.jsx(fe,{placeholder:"O que achou deste artigo? O tamanho serviu bem? O estado estava conforme descrito?",value:C,onChange:a=>X(a.target.value),className:"min-h-[100px]",required:!0})]}),e.jsx(m,{type:"submit",disabled:P||p===0,children:P?"A enviar...":"Publicar Avalia√ß√£o"})]})]}),!r&&e.jsxs("div",{className:"bg-secondary/20 p-6 rounded-xl text-center border border-dashed",children:[e.jsx("p",{className:"text-muted-foreground mb-2",children:"Quer deixar a sua opini√£o?"}),e.jsx(m,{variant:"outline",asChild:!0,children:e.jsx(h,{to:`/login?redirect=/product/${i}`,children:"Fa√ßa login para avaliar"})})]}),v&&e.jsx("div",{className:"bg-secondary/20 p-4 rounded-xl text-center border border-dashed",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Como vendedor, n√£o pode avaliar o seu pr√≥prio artigo."})}),g&&e.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-xl p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h3",{className:"font-semibold text-primary",children:"A sua avalia√ß√£o"})}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(I,{rating:g.rating,readonly:!0,size:"sm"}),e.jsx("span",{className:"text-sm font-medium",children:g.rating.toFixed(1)})]}),e.jsx("p",{className:"text-foreground",children:g.comment})]}),e.jsxs("div",{className:"space-y-6",children:[x.filter(a=>a.userId!==(r==null?void 0:r.uid)).map(a=>{var t;return e.jsxs("div",{className:"border-b pb-6 last:border-0",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-secondary flex items-center justify-center overflow-hidden",children:a.userAvatar?e.jsx("img",{src:a.userAvatar,alt:a.userName,className:"h-full w-full object-cover"}):e.jsx(_,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:a.userName}),e.jsx("p",{className:"text-xs text-muted-foreground",children:(t=a.createdAt)!=null&&t.toDate?xe(a.createdAt.toDate(),{addSuffix:!0,locale:ue}):"Recentemente"})]})]})}),e.jsx("div",{className:"mb-2",children:e.jsx(I,{rating:a.rating,readonly:!0,size:"sm"})}),e.jsx("p",{className:"text-sm text-foreground/80 leading-relaxed",children:a.comment})]},a.id)}),x.length===0&&!g&&e.jsxs("div",{className:"text-center py-12 text-muted-foreground bg-secondary/20 rounded-xl border border-dashed",children:[e.jsx(O,{className:"h-10 w-10 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Ainda n√£o existem avalia√ß√µes para este artigo."}),e.jsx("p",{className:"text-sm",children:"Seja o primeiro a avaliar!"})]})]})]})]})]})]})}export{$e as default};
